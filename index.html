<!DOCTYPE html><html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚ú´ Glucose & Insulin Tracker</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    html {
      scroll-behavior: smooth;
    }
    .dark body {
      background-color: #1e293b;
      color: white;
    }
    .btn:hover {
      transform: scale(1.05);
      transition: all 0.2s ease-in-out;
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 p-4">
  <h1 class="text-3xl font-bold mb-4 text-center text-blue-800 dark:text-blue-300 animate-pulse">ü©∏ Glucose & Insulin Tracker</h1>  <div class="max-w-2xl mx-auto bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
    <label class="block mb-2 font-semibold">Glucose Level (mg/dL)</label>
    <input type="number" id="glucoseInput" class="w-full mb-4 p-2 border rounded dark:bg-gray-700 dark:text-white" /><label class="block mb-2 font-semibold">Test Type</label>
<select id="testTypeInput" onchange="toggleInputs()" class="w-full mb-4 p-2 border rounded dark:bg-gray-700 dark:text-white">
  <option value="Fasting Glucose">üåú Fasting Glucose</option>
  <option value="Post Breakfast">Post Breakfast</option>
  <option value="Pre Lunch">Pre Lunch</option>
  <option value="Post Lunch">Post Lunch</option>
  <option value="Pre Dinner">Pre Dinner</option>
  <option value="Post Dinner">Post Dinner</option>
  <option value="3 AM Test">3 AM Test</option>
  <option value="Bedtime">Bedtime</option>
  <option value="Random">Random Test</option>
</select>

<div id="timePickerDiv" class="hidden mb-4">
  <label class="block mb-2 font-semibold">Custom Time</label>
  <input type="time" id="timeOnlyInput" class="w-full p-2 border rounded dark:bg-gray-700 dark:text-white" />
</div>

<label class="block mb-2 font-semibold">Date</label>
<input type="date" id="dateInput" class="w-full mb-4 p-2 border rounded dark:bg-gray-700 dark:text-white" />

<label class="block mb-2 font-semibold">Insulin Dose (Units)</label>
<input type="number" id="insulinInput" class="w-full mb-4 p-2 border rounded dark:bg-gray-700 dark:text-white" />

<button onclick="addGlucose()" class="btn bg-blue-600 text-white py-2 px-4 rounded w-full mt-2">Add Entry</button>
<div id="warningMessage" class="text-center text-red-600 mt-4 font-bold"></div>

  </div>  <div class="max-w-4xl mx-auto mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
    <canvas id="glucoseChart" class="mb-4"></canvas>
    <button onclick="downloadReport()" class="btn bg-green-600 text-white px-4 py-2 rounded">Download PDF Report</button>
  </div>  <div class="max-w-4xl mx-auto mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md">
    <h2 class="text-xl font-semibold mb-4 text-purple-700 dark:text-purple-300">‚è∞ Set Custom Reminder Times</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div><label>Fasting: <input type="time" id="fastingTime" class="border p-1 rounded w-full dark:bg-gray-700 dark:text-white" /></label></div>
      <div><label>Post Breakfast: <input type="time" id="postBreakfastTime" class="border p-1 rounded w-full dark:bg-gray-700 dark:text-white" /></label></div>
      <div><label>Pre Lunch: <input type="time" id="preLunchTime" class="border p-1 rounded w-full dark:bg-gray-700 dark:text-white" /></label></div>
      <div><label>Post Lunch: <input type="time" id="postLunchTime" class="border p-1 rounded w-full dark:bg-gray-700 dark:text-white" /></label></div>
      <div><label>Pre Dinner: <input type="time" id="preDinnerTime" class="border p-1 rounded w-full dark:bg-gray-700 dark:text-white" /></label></div>
      <div><label>Post Dinner: <input type="time" id="postDinnerTime" class="border p-1 rounded w-full dark:bg-gray-700 dark:text-white" /></label></div>
      <div><label>3 AM Test: <input type="time" id="threeAmTime" class="border p-1 rounded w-full dark:bg-gray-700 dark:text-white" /></label></div>
    </div>
    <button onclick="saveTimes()" class="btn mt-4 bg-purple-600 text-white px-4 py-2 rounded">Save Reminder Times</button>
  </div>  <ul id="entryList" class="max-w-2xl mx-auto mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md"></ul><audio id="highAlert" src="high-alert.mp3"></audio> <audio id="lowAlert" src="low-alert.mp3"></audio>

  <script>
    let glucoseData = JSON.parse(localStorage.getItem("glucoseData")) || [];
    const warning = document.getElementById("warningMessage");

    function toggleInputs() {
      const type = document.getElementById("testTypeInput").value;
      document.getElementById("timePickerDiv").classList.toggle("hidden", type !== "Random");
    }

    function checkWarning(level) {
      if (level > 350) {
        warning.textContent = "‚ö†Ô∏è Sugar is VERY HIGH! Immediate response needed!";
        warning.className = "text-red-600 font-bold animate-bounce";
        document.getElementById("highAlert").play();
      } else if (level < 70) {
        warning.textContent = "‚ö†Ô∏è Sugar is VERY LOW! Glucose treatment needed!";
        warning.className = "text-yellow-400 font-bold animate-bounce";
        document.getElementById("lowAlert").play();
      } else {
        warning.textContent = "";
        warning.className = "";
      }
    }

    function addGlucose() {
      const level = parseFloat(document.getElementById("glucoseInput").value);
      const date = document.getElementById("dateInput").value;
      const type = document.getElementById("testTypeInput").value;
      const time = document.getElementById("timeOnlyInput").value;
      const insulin = parseFloat(document.getElementById("insulinInput").value);

      if (!level || !date || isNaN(insulin) || (type === "Random" && !time)) return alert("Please fill in all fields.");

      const reminderTimes = JSON.parse(localStorage.getItem("reminderTimes")) || {};
      const defaultTime = reminderTimes[type.toLowerCase().replace(/ /g, '')] || "08:00";
      const dateTime = new Date(`${date}T${type === "Random" ? time : defaultTime}`);

      const entry = { level, type, insulin, time: dateTime };
      glucoseData.push(entry);
      localStorage.setItem("glucoseData", JSON.stringify(glucoseData));
      renderChart();
      listEntries();
      checkWarning(level);
      alert("‚úÖ Entry added!");
    }

    function deleteEntry(index) {
      if (!confirm("Delete this entry?")) return;
      glucoseData.splice(index, 1);
      localStorage.setItem("glucoseData", JSON.stringify(glucoseData));
      renderChart();
      listEntries();
    }

    function listEntries() {
      const list = document.getElementById("entryList");
      list.innerHTML = glucoseData.map((e, i) => `
        <li class="flex justify-between items-center border-b py-2">
          <span>${e.type} - ${new Date(e.time).toLocaleString()} - ${e.level} mg/dL - ${e.insulin}U</span>
          <button onclick="deleteEntry(${i})" class="text-red-600 hover:underline">Delete</button>
        </li>
      `).join('');
    }

    function renderChart() {
      const ctx = document.getElementById("glucoseChart").getContext("2d");
      if (window.chart) window.chart.destroy();
      const sorted = glucoseData.sort((a, b) => new Date(a.time) - new Date(b.time));
      const labels = sorted.map(e => `${e.type} - ${new Date(e.time).toLocaleString()}`);
      const data = sorted.map(e => e.level);

      window.chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Glucose Level (mg/dL)',
            data,
            borderColor: '#dc2626',
            backgroundColor: 'rgba(255,99,132,0.1)',
            fill: true
          }]
        },
        options: {
          responsive: true
        }
      });
    }

    function downloadReport() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const rows = glucoseData.map(e => [
        new Date(e.time).toLocaleDateString(),
        e.type,
        e.level,
        e.insulin
      ]);
      doc.text("Glucose & Insulin Report", 14, 16);
      doc.autoTable({ head: [["DATE", "TEST TYPE", "GLUCOSE", "INSULIN"]], body: rows, startY: 20 });
      doc.save("glucose_insulin_report.pdf");
    }

    function saveTimes() {
      const reminderTimes = {
        fastingglucose: document.getElementById("fastingTime").value,
        postbreakfast: document.getElementById("postBreakfastTime").value,
        prelunch: document.getElementById("preLunchTime").value,
        postlunch: document.getElementById("postLunchTime").value,
        predinner: document.getElementById("preDinnerTime").value,
        postdinner: document.getElementById("postDinnerTime").value,
        "3amtest": document.getElementById("threeAmTime").value
      };
      localStorage.setItem("reminderTimes", JSON.stringify(reminderTimes));
      alert("‚è∞ Reminder times saved!");
    }

    renderChart();
    listEntries();
  </script></body>
</html>
